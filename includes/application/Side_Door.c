/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include "Side_Door.h"

#include "Servo.h"
#include "Delay.h"

/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/
#define DUTY_OPEN       14
#define DUTY_CLOSE      30
#define DUTY_STEP       1

#define DELAY           1000        // ms

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/
uint32 g_duty = DUTY_CLOSE;

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/
void Control_Door(uint8 *state) {
    switch(*state) {
    case DOOR_OPEN:
        g_duty=DUTY_OPEN;
        break;
    case DOOR_CLOSE:
        g_duty=DUTY_CLOSE;
        break;
    case DOOR_OPENING:
        if (g_duty > DUTY_OPEN) {
            g_duty -= DUTY_STEP;
        }
        if (g_duty <= DUTY_OPEN) {
            *state = DOOR_OPEN;
        }
        Delay_Ms(200);
        break;
    case DOOR_CLOSING:
        if (g_duty < DUTY_CLOSE) {
            g_duty += DUTY_STEP;
        }
        if (g_duty >= DUTY_CLOSE) {
            *state = DOOR_CLOSE;
        }
        Delay_Ms(200);
        break;
    case DOOR_STOP:
        break;
    default:
        break;
    }
    Set_Duty_Door(g_duty);
}
