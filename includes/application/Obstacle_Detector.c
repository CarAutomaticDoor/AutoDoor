/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include "Obstacle_Detector.h"

#include "Ultrasonic.h"

#include "Platform_Types.h"
/*********************************************************************************************************************/
/*------------------------------------------------------Macros-------------------------------------------------------*/
/*********************************************************************************************************************/
#define TIME_OUT    0.00001f
#define THRESHOLD   10.0f

/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/
Ultrasonic g_obstacle_config = {.trig = {&MODULE_P00, 3}, .echo = {&MODULE_P00, 4}};

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/
void Init_Obstacle_Sensor(){
    // 초기 설정. trig, echo pin 입출력 세팅.
    Init_Ultrasonic(&g_obstacle_config);
}

// return TRUE if obstacle detected
boolean Read_Obstacle_Detection_State(void) {

    /*
     * 초기값은 return : FALSE  (감지 X), 감지가 된다면 return : TRUE (감지 O)
     * 매개변수 threshold_dist : 임계값 거리
     */

    // float32 foot_distance = Get_Ultrasonic_Distance(&g_Foot_Config);
    float32 obstacle_distance = Get_Ultrasonic_Distance(&g_obstacle_config);

    return ((TIME_OUT < obstacle_distance) && (obstacle_distance <= THRESHOLD));
}
